<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Zip解凍（ローカル）</title>
    <style>
      body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, sans-serif; background:#f6f7f9; margin:0}
      .wrap{max-width:900px;margin:40px auto;padding:24px}
      .card{background:#fff;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08);padding:24px}
      h1{font-size:1.4rem;margin:0 0 16px}
      .drop{border:2px dashed #dadde3;border-radius:12px;padding:32px;text-align:center}
      .drop:hover{background:#fafbfc}
      .muted{color:#6b7280;font-size:.9rem}
      ul{list-style:none;padding:0}
      li{padding:8px 0;border-bottom:1px solid #f0f2f5}
      .name{word-break:break-all}
      .footer{margin-top:16px;color:#6b7280;font-size:.85rem}
      button{padding:10px 16px;border-radius:10px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
      button:hover{background:#f9fafb}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.8.1/umd/index.min.js"></script>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>Zip解凍（ブラウザだけで完結）</h1>
        <div class="drop">
          <input id="file" type="file" accept=".zip,application/zip" />
          <div class="muted">※ファイルはサーバーに送信されません。端末内で解凍されます。</div>
          <div style="margin-top:8px"><button id="btn">解凍する</button></div>
        </div>
        <div id="status" class="footer"></div>
        <h2 style="margin-top:24px">ファイル一覧</h2>
        <ul id="list"></ul>
      </div>
    </div>
    <script>
      const $ = (s)=>document.querySelector(s);
      const list = $('#list');
      const status = $('#status');
      const btn = $('#btn');
      btn.addEventListener('click', async () => {
        const file = $('#file').files[0];
        if(!file){ alert('Zipファイルを選択してください'); return; }
        list.innerHTML = ''; status.textContent = '解凍中…';
        try{
          const buf = new Uint8Array(await file.arrayBuffer());
          fflate.unzip(buf, (err, data) => {
            if(err){ status.textContent = '解凍に失敗: ' + err; return; }
            const entries = Object.entries(data).sort((a,b)=>a[0].localeCompare(b[0]));
            status.textContent = `展開完了：${entries.length} 件`;
            for(const [name, bytes] of entries){
              const li = document.createElement('li');
              li.innerHTML = `<div class="name">${name}</div>`;
              // ディレクトリはスキップ
              if(bytes.length === 0 && name.endsWith('/')){ list.appendChild(li); continue; }
              const blob = new Blob([bytes.buffer], { type: 'application/octet-stream' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url; a.download = name.split('/').pop(); a.textContent = 'ダウンロード';
              a.style.display = 'inline-block'; a.style.marginTop = '6px';
              li.appendChild(a); list.appendChild(li);
            }
          });
        }catch(e){ status.textContent = '解凍に失敗: ' + (e?.message||e); }
      });
    </script>
  </body>
</html>